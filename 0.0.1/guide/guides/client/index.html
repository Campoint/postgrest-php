<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
            <title>Documentation</title>
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="../../../">
    <link rel="icon" href="images/favicon.ico"/>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/base.css">
            <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@100;200;300;400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="css/template.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-okaidia.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.css">
                <script src="https://cdn.jsdelivr.net/npm/fuse.js@3.4.6"></script>
        <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
        <script src="js/template.js"></script>
        <script src="js/search.js"></script>
        <script defer src="js/searchIndex.js"></script>
    </head>
<body id="top">
    <header class="phpdocumentor-header phpdocumentor-section">
    <h1 class="phpdocumentor-title"><a href="" class="phpdocumentor-title__link">Documentation</a></h1>
    <input class="phpdocumentor-header__menu-button" type="checkbox" id="menu-button" name="menu-button" />
    <label class="phpdocumentor-header__menu-icon" for="menu-button">
        <i class="fas fa-bars"></i>
    </label>
    <section data-search-form class="phpdocumentor-search">
    <label>
        <span class="visually-hidden">Search for</span>
        <svg class="phpdocumentor-search__icon" width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="7.5" cy="7.5" r="6.5" stroke="currentColor" stroke-width="2"/>
            <line x1="12.4892" y1="12.2727" x2="19.1559" y2="18.9393" stroke="currentColor" stroke-width="3"/>
        </svg>
        <input type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading .." disabled />
    </label>
</section>

    <nav class="phpdocumentor-topnav">
    <ul class="phpdocumentor-topnav__menu">
        </ul>
</nav>
</header>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <input class="phpdocumentor-sidebar__menu-button" type="checkbox" id="sidebar-button" name="sidebar-button" />
<label class="phpdocumentor-sidebar__menu-icon" for="sidebar-button">
    Menu
</label>
<aside class="phpdocumentor-column -three phpdocumentor-sidebar">
                    <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">documentation</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/getting-started/index.html#getting-started" class="">Getting started</a>
</h4>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/guides/index.html#guides" class="">Guides</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="guide/guides/client/index.html#client" class="">Client</a>
                
            </li>
                    <li>
                <a href="guide/guides/request-builder/index.html#requestbuilder" class="">RequestBuilder</a>
                
            </li>
                    <li>
                <a href="guide/guides/response/index.html#response" class="">Response</a>
                
            </li>
            </ul>

                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="guide/changelog/index.html#changelog" class="">Changelog</a>
</h4>

                        </section>
                <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="namespaces/postgrestphp.html" class="">PostgrestPhp</a>
</h4>
    <ul class="phpdocumentor-list">
                    <li>
                <a href="namespaces/postgrestphp-client.html" class="">Client</a>
                
            </li>
                    <li>
                <a href="namespaces/postgrestphp-requestbuilder.html" class="">RequestBuilder</a>
                
            </li>
                    <li>
                <a href="namespaces/postgrestphp-response.html" class="">Response</a>
                
            </li>
            </ul>

                        </section>
                <section class="phpdocumentor-sidebar__category">
            <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                                    <h4 class="phpdocumentor-sidebar__root-namespace">
    <a href="packages/PostgrestPhp.html" class="">PostgrestPhp</a>
</h4>

                        </section>
            
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="graphs/classes.html">Class Diagram</a></h3>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="indices/files.html">Files</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -nine phpdocumentor-content">
                                        <div class="section" id="client">
    <h1>Client</h1>

            <p>postgrest-php provides two clients to interact with PostgreSQL, a
synchronous and an asynchronous one. Both clients implement the client
interface and the main difference between them, is the return type when
executing request against PostgREST.</p>
            <div class="contents"><ul class="phpdocumentor-list"><li class="toc-item"><a href="guide/guides/client/index.html#configuration">Configuration</a><ul class="section-level-1"><li class="toc-item"><a href="guide/guides/client/index.html#general">General</a></li><li class="toc-item"><a href="guide/guides/client/index.html#authentication">Authentication</a></li></ul></li><li class="toc-item"><a href="guide/guides/client/index.html#usage">Usage</a><ul class="section-level-1"><li class="toc-item"><a href="guide/guides/client/index.html#async">Async</a></li></ul></li><li class="toc-item"><a href="guide/guides/client/index.html#exceptions">Exceptions</a></li></ul></div>
            <div class="section" id="configuration">
    <h2>Configuration</h2>

            <p>Both clients are mainly configured over their constructor method which
they share over a base class which both clients extend.</p>
            <div class="section" id="general">
    <h3>General</h3>

            <p>To instantiate the client you will need to provide the URL for the
PostgREST server. Additionally to the URL, you can pass a custom timeout
value. Please mind, that even if you pass a custom <code>Browser</code> object to
the constructor, the <code>baseUrl</code> and <code>timeout</code> parameters will be
overwritten.</p>
            <pre><code class="language-php">// specify baseUrl and timeout
$client = new PostgrestSyncClient(
    &#039;http://localhost:8080&#039;,
    5,
    // baseUrl and timeout configuration will be overwritten
    (new Browser(null, $loop)-&gt;withBase(&#039;https://foo.bar&#039;)-&gt;withTimeout(10))
);</code></pre>
    </div>

            <div class="section" id="authentication">
    <h3>Authentication</h3>

            <p>You have two ways to authenticate the client, you can either provide a
JWT token yourself, using <code>setAuthToken</code> on the client, or give the
client the needed credentials to get a token from PostgREST. To provide
the client with credentials, use the <code>ClientAuthConfig</code> object.
<a href=""></a></p>
            <pre><code class="language-php">// provide the token yourself
$token = &#039;&lt;YOUR_JWT_TOKEN_HERE&gt;&#039;;
$client = new PostgrestSyncClient(&#039;http://localhost:8080&#039;, 5);
$client-&gt;setAuthToken($token);
$client-&gt;run(...);</code></pre>
            <pre><code class="language-php">// pass credentials
$clientAuthConfig = new ClientAuthConfig(
    authArguments: [
        &#039;email&#039; =&gt; &#039;test@acme.dev&#039;,
        &#039;pass&#039; =&gt; &#039;password&#039;,
    ],
);
// pass auth config to client
$client = new PostgrestSyncClient(
    &#039;http://localhost:8080&#039;,
    5,
    clientAuthConfig: $clientAuthConfig
);
$client-&gt;auth();
$client-&gt;run(...);</code></pre>
            <p>When providing credentials for authentication you can choose to enable
the auto authentication feature using the according parameter in the
<code>ClientAuthConfig</code> constructor. This feature will ensure before every
request that the client is still authenticated, if not,
re-authentication will be triggered automatically. When enabling this
feature you must also set a grace time period (if you do not want to use
the default of 300) which will be subtracted from the token expiration
time to ensure that the token gets renewed before the old one expires.</p>
            <pre><code class="language-php">// enable auto authentication feature
$clientAuthConfig = new ClientAuthConfig(
    authArguments: [
        &#039;email&#039; =&gt; &#039;test@acme.dev&#039;,
        &#039;pass&#039; =&gt; &#039;password&#039;,
    ],
    autoAuth: true,
    autoAuthGrace: 120
);
$client = new PostgrestSyncClient(
    &#039;http://localhost:8080&#039;,
    5,
    clientAuthConfig: $clientAuthConfig
);
$client-&gt;run(...);</code></pre>
            <pre><code class="language-php">$clientAuthConfig = new ClientAuthConfig(
    authArguments: [
        &#039;email&#039; =&gt; &#039;test@acme.dev&#039;,
        &#039;pass&#039; =&gt; &#039;password&#039;,
    ],
);
$client = new PostgrestSyncClient(
    &#039;http://localhost:8080&#039;,
    5,
    clientAuthConfig: $clientAuthConfig
);
// enable auto authentication feature
$client-&gt;enableAutoAuth(autoAuthGrace: 120);
$client-&gt;run(...);
// disable auto authentication feature
$client-&gt;disableAutoAuth();</code></pre>
            <p>When providing credentials for client authentication, you can
additionally choose the name for the stored procedure which is
responsible for authentication and the schema name in which the stored
procedure resides.</p>
            <pre><code class="language-php">// specify stored procedure name and schema
$clientAuthConfig = new ClientAuthConfig(
    authArguments: [
        &#039;email&#039; =&gt; &#039;test@acme.dev&#039;,
        &#039;pass&#039; =&gt; &#039;password&#039;,
    ],
    authSchemaName: &#039;custom_schema&#039;,
    authFunctionName: &#039;custom_login&#039;
);
$client = new PostgrestSyncClient(
    &#039;http://localhost:8080&#039;,
    5,
    clientAuthConfig: $clientAuthConfig
);
$client-&gt;auth();
$client-&gt;run(...);</code></pre>
    </div>

    </div>

            <div class="section" id="usage">
    <h2>Usage</h2>

            <p>Once you have instantiated a client, there are three ways to use the
client: start building a request, run a stored procedure or run a query.</p>
            <pre><code class="language-php">// start building a query
$query = $client-&gt;from(&#039;schema_name&#039;, &#039;table_name&#039;)
    -&gt;select(&#039;*&#039;)
    -&gt;eq(&#039;foo&#039;, &#039;bar&#039;);</code></pre>
            <pre><code class="language-php">// run a query
$response = $client-&gt;run($query);</code></pre>
            <pre><code class="language-php">// call a stored procedure
$response = $client-&gt;call(
    &#039;my_function&#039;,
    [
        &#039;arg1&#039; =&gt; &#039;foo&#039;,
        &#039;arg2&#039; =&gt; &#039;bar&#039;
    ]
);</code></pre>
            <div class="section" id="async">
    <h3>Async</h3>

            <p>The async client will return a <code>PromiseInterface</code> instead of a
<code>PostgrestResponse</code> when calling the <code>run()</code> and <code>call()</code> methods.
Also, the <code>auth()</code> method will return a <code>PromiseInterface</code> instead
of <code>null</code> or throwing a <code>FailedAuthException</code>. You can use these
promises as any other ReactPHP <code>PromiseInterface</code> in your code.</p>
            <pre><code class="language-php">$asyncClient-&gt;auth()-&gt;then(
    function () {
        // auth succeeded
    },
    function (Throwable $e) {
        // auth failed
        // Should always be FailedAuthException
    }
);</code></pre>
            <pre><code class="language-php">$asyncClient-&gt;run($query)-&gt;then(
    function (PostgrestResponse $response) {
        // Handle returned data
    },
    function (Throwable $e) {
        // Handle error
        // FailedAuthException only possible with $autoAuth enabled
        // PostgrestErrorException wraps all other exceptions
    }
);</code></pre>
    </div>

    </div>

            <div class="section" id="exceptions">
    <h2>Exceptions</h2>

            <p>There are two exceptions which can be thrown upon an error when running
a query. The first one, <code>FailedAuthException</code> will be thrown when the
authentication process fails. The <code>run()</code> method will only throw the
<code>FailedAuthException</code>, if you use the <code>autoAuth</code> feature. The
<code>auth()</code> and <code>setAuthToken()</code> methods throw the
<code>FailedAuthException</code> when the request to PostgREST or parsing the
token fails. The other exception is <code>PostgrestErrorException</code>, which
wraps all <code>Exceptions</code> thrown by <code>Browser::request()</code> and parses the
PostgREST error when one is returned. <code>PostgrestErrorException</code> tries
to parse the response body (if there is one) and extracts the PostgREST
error message and code. If no PostgREST error message and code are
found, the response status code and body will be used as the exception
message. If the the previous <code>Exception</code> has no response, the message
of the <code>Exception</code> will be used as the message for the
<code>PostgrestErrorException</code>.</p>
    </div>

    </div>

                            </div>
            <section data-search-results class="phpdocumentor-search-results phpdocumentor-search-results--hidden">
    <section class="phpdocumentor-search-results__dialog">
        <header class="phpdocumentor-search-results__header">
            <h2 class="phpdocumentor-search-results__title">Search results</h2>
            <button class="phpdocumentor-search-results__close"><i class="fas fa-times"></i></button>
        </header>
        <section class="phpdocumentor-search-results__body">
            <ul class="phpdocumentor-search-results__entries"></ul>
        </section>
    </section>
</section>
        </div>
        <a href="guide/guides/client/index.html#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <script>
        cssVars({});
    </script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
</body>
</html>
